{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>3D Super Market</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.179.1/examples/jsm/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.179.1/examples/jsm/loaders/HDRCubeTextureLoader.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            font-family: 'Prompt', sans-serif;
            overflow: hidden;
        }
        
        h3 {
            color: #ffffff;
            font-size: 24px;
            margin: 0;
        }

        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: #0000007e;
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        #controls {
            position: absolute;
            bottom: 5%;
            left: 5%;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }

        .checkout-btn {
            background: #2196F3;
            width: 100%;
            margin-top: 15px;
        }

        .checkout-btn:hover {
            background: #1976D2;
        }
                
        .stats {
            font-size: 18px;
            margin-top: 10px;
        }

        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ */
        #shopping-menu {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 200;
        }

        #product-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .product-name {
            font-size: 16px;
        }

        .add-to-cart-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .add-to-cart-btn:hover {
            background: #0056b3;
        }
        audio {
            width: 300px;
            height: 100px;
            position: fixed;
            bottom: 6%;
            left: 50%;
        }
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏° Media Queries ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        @media only screen and (max-width: 768px) {
            #info {
                top: 10px;
                left: 10px;
                right: 10px;
                padding: 10px;
                font-size: 14px;
            }

            h3 {
                font-size: 18px;
            }

            .stats {
                font-size: 14px;
            }

            #controls {
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                width: 90%;
                max-width: 400px;
            }

            button {
                padding: 8px 16px;
                font-size: 12px;
                margin: 3px;
                min-width: 80px;
            }

            #shopping-menu {
                width: 90%;
                max-width: 350px;
                padding: 15px;
            }

            .product-name {
                font-size: 14px;
            }

            .add-to-cart-btn {
                padding: 4px 8px;
                font-size: 11px;
            }

            audio {
                width: 200px;
                height: 40px;
                bottom: 15%;
                left: 50%;
                transform: translateX(-50%);
            }

            /* ‡πÄ‡∏û‡∏¥‡πà‡∏° Touch Events Support */
            * {
                touch-action: manipulation;
            }

            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            .add-to-cart-btn,
            .checkout-btn,
            #continue-btn,
            #goto-cashier-btn {
                min-height: 44px;
                padding: 12px 20px;
            }
        }

        /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å */
        @media only screen and (max-width: 320px) {
            #info {
                padding: 8px;
            }

            h3 {
                font-size: 16px;
            }

            .stats {
                font-size: 12px;
            }

            button {
                padding: 6px 12px;
                font-size: 11px;
                margin: 2px;
            }
        }

        /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏°‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        @viewport {
            width: device-width;
            zoom: 1.0;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="info">
            <h3>üè™ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ 3D</h3>
            <div class="stats" id="stats"></div>
        </div>
        
        <div id="controls">
            <button id="startBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
            <button id="pauseBtn" disabled>‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</button>
            <button id="resetBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
            <button id="cameraBtn">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
        </div>

        <div id="shopping-menu" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.8); color: white; padding: 20px; border-radius: 10px; z-index: 200;">
            <h3>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á‡∏ô‡∏µ‡πâ</h3>
            <div id="product-list"></div>
            <div style="margin-top: 10px;">
                <button id="continue-btn">‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡πà‡∏≠</button>
                <button id="goto-cashier-btn">‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏≤‡∏ó‡πå‡πÄ‡∏ï‡∏≠‡∏£‡πå</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, avatar, mixer;
        let isRunning = false, isPaused = false;
        let currentPathIndex = 0;
        let cameraMode = 0; // 0: overview, 1: follow, 2: first person

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
        let isShoppping = false;
        let currentShelf = null;

        let storeAudio = null;
        let isAudioPlaying = false;

        // ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏ü‡∏ü‡πâ‡∏≤
        const productsList = [
            { name: "‡πÇ‡∏Ñ‡∏°‡πÑ‡∏ü", price: 159, color: 0xcccccc, shelfId: 1 },
            { name: "‡πÇ‡∏Ñ‡∏°‡πÑ‡∏ü‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô Plus Three", price: 159, color: 0xcccccc, shelfId: 1 },
            { name: "Solar Cell", price: 2990, color: 0x1a237e, shelfId: 2 },
            { name: "‡∏™‡∏≤‡∏¢‡πÑ‡∏ü 1 m", price: 89, color: 0xff6600, shelfId: 3 },
            { name: "‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏ä‡πâ‡∏≤‡∏á 2 ‡∏ï‡∏≤", price: 19, color: 0x00ffcc, shelfId: 4 },
            { name: "‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü LED 50 ‡∏ã.", price: 199, color: 0xffff00, shelfId: 5 },
            { name: "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡πà‡∏≠", price: 230, color: 0x00ffcc, shelfId: 6 },
            { name: "‡∏õ‡∏•‡∏±‡πä‡∏Å‡πÑ‡∏ü 2 ‡∏ä‡πà‡∏≠‡∏á", price: 129, color: 0xcccccc, shelfId: 7 },
            { name: "‡∏™‡∏≤‡∏¢‡πÑ‡∏ü 1 m", price: 69, color: 0xff6600, shelfId: 8 },
            { name: "‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏ä‡πâ‡∏≤‡∏á 3 ‡∏ï‡∏≤", price: 29, color: 0x00ffcc, shelfId: 9 },
            { name: "‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü LED", price: 250, color: 0xffff00, shelfId: 10 },
            { name: "‡∏õ‡∏•‡∏±‡πä‡∏Å‡πÑ‡∏ü 3 ‡∏ä‡πà‡∏≠‡∏á", price: 159, color: 0xcccccc, shelfId: 11 },
        ];

        let cart = [];
        let hasBag = false;

        // Store layout based on the image
        const storeLayout = {
            width: 22,
            height: 12,
            shelves: [
                { id: 1, x: -4, z: -5, width: 3, height: 1.5, depth: 0.8 },
                { id: 2, x: 0, z: -5, width: 3, height: 1.5, depth: 0.8 },
                { id: 3, x: 4, z: -5, width: 3, height: 1.5, depth: 0.8 },
                { id: 4, x: 2, z: -1.5, width: 6, height: 1.5, depth: 0.8 },
                { id: 5, x: -4, z: -1.5, width: 3, height: 1.5, depth: 0.8 },
                { id: 6, x: 0, z: 2, width: 3, height: 1.5, depth: 0.8 },
                { id: 7, x: -4, z: 2, width: 3, height: 1.5, depth: 0.8 },
                { id: 8, x: 4, z: 2, width: 3, height: 1.5, depth: 0.8 },
                { id: 9, x: 2, z: 5.5, width: 6, height: 1.5, depth: 0.8 },
                { id: 10, x: -4, z: 5.5, width: 3, height: 1.5, depth: 0.8 },
                { id: 11, x: 10, z: 2, width: 0.1, height: 0.1, depth: 0.1 }
            ]
        };
        
        // Path for avatar movement (based on red line in image)
        const movementPath = [
            { x: -8, z: 5.5, shelfId: null },// IN
            { x: -8, z: 0, shelfId: 1 },
            { x: -8, z: -4, shelfId: 2 },
            { x: -4, z: -4, shelfId: 3 },
            { x: -0, z: -4, shelfId: 4 },
            { x: 4, z: -4, shelfId: 5 },
            { x: 8, z: -4, shelfId: 6 },
            { x: 8, z: 0, shelfId: null },
            { x: 2, z: 0, shelfId: 7 },
            { x: -4, z: 0, shelfId: 8 },
            { x: -7, z: 0, shelfId: null },
            { x: -7, z: 4, shelfId: null },
            { x: -4, z: 4, shelfId: 9 },
            { x: 0, z: 4, shelfId: 10 },
            { x: 4, z: 4, shelfId: 11 },
            { x: 7.9, z: 2, shelfId: 'cashier' }, // Go to cashier
            { x: 8, z: 2, shelfId: null },
            { x: 8, z: 5.5, shelfId: null }// OUT
        ];

        
        function init() {
            // Create scene
            scene = new THREE.Scene();
            /*// ‡πÉ‡∏ä‡πâ TextureLoader ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
            const textureLoader = new THREE.TextureLoader();
            const bgTexture = textureLoader.load('{% static "images/backgrounds/worldmap.jpg" %}'); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏≤‡∏ò‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
            scene.background = bgTexture;

            // ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏â‡∏≤‡∏Å
            bgTexture.mapping = THREE.EquirectangularReflectionMapping;

            // ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏≠‡∏Å
            scene.fog = new THREE.Fog(0xffffff, 50, 100);
            
            scene = new THREE.Scene();*/
            scene.background = new THREE.Color(0xE0E0E0);
            scene.fog = new THREE.Fog(0xf0f0f0, 50, 100);
            
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 15, 15);
            camera.lookAt(0, 0, 0);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true; 
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);
            
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà
            const audioControls = document.createElement('div');
            audioControls.style.position = 'absolute';
            audioControls.style.top = '20px';
            audioControls.style.right = '20px';
            audioControls.style.zIndex = '100';
            audioControls.innerHTML = `
                <audio class="storeAudio" id="storeAudio" controls>
                    <source src="{% static 'sounds/download.mp3' %}" type="audio/mp3">
                    Your browser does not support the audio element.
                </audio>
            `;
            document.getElementById('container').appendChild(audioControls);

            storeAudio = document.getElementById('storeAudio');
            
            // Add lights
            setupLighting();
            
            // Create store and characters
            createStore();
            createAvatar();
            createReceptionist();
            createCashier();
            createPipelineYellow();
            createPipelineWhite();
            createLighting();
            createCounter();
            createSolarCell();

            // Setup controls
            setupControls();
            
            // Start render loop
            animate();
        }

        function startSimulation() {
            isRunning = true;
            isPaused = false;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;

            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°
            if (storeAudio && !isAudioPlaying) {
                storeAudio.play().then(() => {
                    document.getElementById('audioBtn').textContent = '‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á';
                    isAudioPlaying = true;
                }).catch(err => {
                    console.error('Error playing audio:', err);
                });
            }
        }

        function pauseSimulation() {
            isPaused = !isPaused;
            const btn = document.getElementById('pauseBtn');
            btn.textContent = isPaused ? '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πà‡∏≠' : '‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß';

            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢
            if (storeAudio) {
                if (isPaused) {
                    storeAudio.pause();
                } else {
                    storeAudio.play();
                }
            }
        }

        function resetSimulation() {
            isRunning = false;
            isPaused = false;
            isShoppping = false;
            currentPathIndex = 0;
            cart = [];
            hasBag = false;
            
            avatar.position.set(movementPath[0].x, 0, movementPath[0].z);
            
            if (avatar.bagMesh) {
                avatar.remove(avatar.bagMesh);
                avatar.bagMesh = null;
            }
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢
            if (storeAudio) {
                storeAudio.pause();
                storeAudio.currentTime = 0;
                isAudioPlaying = false;
            }
            
            document.getElementById('shopping-menu').style.display = 'none';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('pauseBtn').textContent = '‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß';
        }
        
        function setupLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x858585, 0.4);
            scene.add(ambientLight);
            
            // Main directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Store interior lights
            for (let i = 0; i < 4; i++) {
                const light = new THREE.PointLight(0xffffff, 0.5, 10);
                light.position.set((i - 1.5) * 4, 4, 0);
                scene.add(light);
            }
        }
        
        function createPipelineYellow() {
            const textureLoader = new THREE.TextureLoader();
            const pipeGroup = new THREE.Group();
            
            // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≠‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á
            const positions = [
                [8, 1.5, -5.8],
                [7.7, 1.5, -5.8],
                [7.4, 1.5, -5.8],
                [7.1, 1.5, -5.8],
                [6.8, 1.5, -5.8],
                [6.5, 1.5, -5.8]
            ];

            positions.forEach(pos => {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏£‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°
                const geometry = new THREE.CylinderGeometry(0.1, 0.1, 3, 64);
                
                // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ó‡∏Ñ‡∏ã‡πå‡πÄ‡∏à‡∏≠‡∏£‡πå
                const texture = textureLoader.load('{% static "images/layout/pipeend_yl.png" %}'); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                const material = new THREE.MeshBasicMaterial({ 
                    map: texture,
                    color: 0xffff00,
                    transparent: true,
                    opacity: 1.0
                });
                
                const pipe = new THREE.Mesh(geometry, material);
                pipe.position.set(...pos);
                pipeGroup.add(pipe);
            });

            scene.add(pipeGroup);
        }

        function createPipelineWhite() {
            const textureLoader = new THREE.TextureLoader();
            const pipeGroup = new THREE.Group();
            
            // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≠‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß
            const positions = [
                [10.8, 1.5, -4.0],
                [10.8, 1.5, -3.7],
                [10.8, 1.5, -3.4],
                [10.8, 1.5, -3.1],
                [10.8, 1.5, -2.8],
                [10.8, 1.5, -2.5]
            ];

            positions.forEach(pos => {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏£‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°
                const geometry = new THREE.CylinderGeometry(0.1, 0.1, 3, 64);
                
                // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ó‡∏Ñ‡∏ã‡πå‡πÄ‡∏à‡∏≠‡∏£‡πå
                const texture = textureLoader.load('{% static "images/layout/pipeend_w.png" %}'); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                const material = new THREE.MeshBasicMaterial({ 
                    map: texture,
                    color: 0xffffff,
                    transparent: true,
                    opacity: 1.0
                });
                
                const pipe = new THREE.Mesh(geometry, material);
                pipe.position.set(...pos);
                pipeGroup.add(pipe);
            });

            scene.add(pipeGroup);
        }

        function createLighting() {
            const lightGroup = new THREE.Group();
            const textureLoader = new THREE.TextureLoader();

            // ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞
            const lightingGeometry = new THREE.BoxGeometry(1, 3, 6);
            const lightingMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x8B4513,
                transparent: true,
                opacity: 1.0 
            });
            const lightingMesh = new THREE.Mesh(lightingGeometry, lightingMaterial);
            lightingMesh.position.set(-10.5, 1.0, 0);
            lightGroup.add(lightingMesh);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤
            const sideGeometry = new THREE.PlaneGeometry(6, 3); // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞
            const sideTexture = textureLoader.load('{% static "images/layout/Gemini_Generated_Image_mh2bidmh2bidmh2b.png" %}');
            const sideMaterial = new THREE.MeshBasicMaterial({
                map: sideTexture,
                transparent: true,
                side: THREE.DoubleSide
            });

            // ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤
            const rightMesh = new THREE.Mesh(sideGeometry, sideMaterial);
            rightMesh.position.set(-9.99, 1.0, 0); // x + 0.5 ‡∏à‡∏≤‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÇ‡∏ï‡πä‡∏∞
            rightMesh.rotation.y = Math.PI / 2; // ‡∏´‡∏°‡∏∏‡∏ô 90 ‡∏≠‡∏á‡∏®‡∏≤
            lightGroup.add(rightMesh);

            scene.add(lightGroup);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡∏°‡πÑ‡∏ü‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÇ‡∏ï‡πä‡∏∞
            const emergencyGeometry = new THREE.BoxGeometry(0.3, 0.6, 0.6);
            const emergencyMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            const emergencyMesh = new THREE.Mesh(emergencyGeometry, emergencyMaterial);
            emergencyMesh.position.set(-10.5, 2.7, 0);
            scene.add(emergencyMesh);

            const imgemergencyGeometry = new THREE.PlaneGeometry(0.6, 0.4);
            const imgemergencyTexture = textureLoader.load('{% static "images/layout/Product01.png" %}');
            const imgemergencyMaterial = new THREE.MeshBasicMaterial({
                map: imgemergencyTexture,
                transparent: true,
                side: THREE.DoubleSide
            });
            const imgemergencyMesh = new THREE.Mesh(imgemergencyGeometry, imgemergencyMaterial);
            imgemergencyMesh.position.set(-10.34, 2.7, 0); // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            imgemergencyMesh.rotation.y = -Math.PI / 2; // ‡∏´‡∏°‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            scene.add(imgemergencyMesh);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡∏°‡πÑ‡∏ü‡∏â‡∏±‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÇ‡∏ï‡πä‡∏∞ ‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á
            const emergencyMesh2 = new THREE.Mesh(emergencyGeometry, emergencyMaterial);
            emergencyMesh2.position.set(-10.5, 2.7, -1);
            scene.add(emergencyMesh2);
            const imgemergencyMesh2 = new THREE.Mesh(imgemergencyGeometry, imgemergencyMaterial);
            imgemergencyMesh2.position.set(-10.34, 2.7, -1); // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            imgemergencyMesh2.rotation.y = -Math.PI / 2; // ‡∏´‡∏°‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            scene.add(imgemergencyMesh2);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡∏°‡πÑ‡∏ü‡∏â‡∏±‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÇ‡∏ï‡πä‡∏∞ ‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°
            const emergencyMesh3 = new THREE.Mesh(emergencyGeometry, emergencyMaterial);
            emergencyMesh3.position.set(-10.5, 2.7, 1);
            scene.add(emergencyMesh3);
            const imgemergencyMesh3 = new THREE.Mesh(imgemergencyGeometry, imgemergencyMaterial);
            imgemergencyMesh3.position.set(-10.34, 2.7, 1); // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            imgemergencyMesh3.rotation.y = -Math.PI / 2; // ‡∏´‡∏°‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            scene.add(imgemergencyMesh3);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡∏°‡πÑ‡∏ü‡∏â‡∏±‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÇ‡∏ï‡πä‡∏∞ ‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏µ‡πà
            const emergencyMesh4 = new THREE.Mesh(emergencyGeometry, emergencyMaterial);
            emergencyMesh4.position.set(-10.5, 2.7, 2);
            scene.add(emergencyMesh4);
            const imgemergencyMesh4 = new THREE.Mesh(imgemergencyGeometry, imgemergencyMaterial);
            imgemergencyMesh4.position.set(-10.34, 2.7, 2); // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            imgemergencyMesh4.rotation.y = -Math.PI / 2; // ‡∏´‡∏°‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            scene.add(imgemergencyMesh4);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡∏°‡πÑ‡∏ü‡∏â‡∏±‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô‡πÇ‡∏ï‡πä‡∏∞ ‡∏≠‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≤
            const emergencyMesh5 = new THREE.Mesh(emergencyGeometry, emergencyMaterial);
            emergencyMesh5.position.set(-10.5, 2.7, -2);
            scene.add(emergencyMesh5);
            const imgemergencyMesh5 = new THREE.Mesh(imgemergencyGeometry, imgemergencyMaterial);
            imgemergencyMesh5.position.set(-10.34, 2.7, -2); // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            imgemergencyMesh5.rotation.y = -Math.PI / 2; // ‡∏´‡∏°‡∏∏‡∏ô‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            scene.add(imgemergencyMesh5);
            
        }

        function createSolarCell() {
            const solarGroup = new THREE.Group();
            const textureLoader = new THREE.TextureLoader();

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏á Solar Cell
            const solarGeometry = new THREE.BoxGeometry(4, 4, 0.1);
            const solarMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x000000,
                transparent: true,
                opacity: 0.8
            });
            const solarMesh = new THREE.Mesh(solarGeometry, solarMaterial);
            solarMesh.position.set(-8, 1.0, -5.89);
            solarGroup.add(solarMesh);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
            const frontGeometry = new THREE.PlaneGeometry(4, 4);
            const frontTexture = textureLoader.load('{% static "images/layout/Solar Cell.png" %}');
            const frontMaterial = new THREE.MeshBasicMaterial({
                map: frontTexture,
                transparent: true,
                side: THREE.DoubleSide
            });
            const frontMesh = new THREE.Mesh(frontGeometry, frontMaterial);
            frontMesh.position.set(-8, 1.0, -5.83); // z + 0.05 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤

            scene.add(solarGroup);
            scene.add(frontMesh);
        }

        function createStore() {
            // Floor
            const floorGeometry = new THREE.PlaneGeometry(storeLayout.width, storeLayout.height);
            const floorMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xffffff,
                transparent: true,
                opacity: 1.0
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = false;
            scene.add(floor);
            
            // Walls
            createWalls();
            
            // Shelves
            createShelves();
            
            // Entrance and exit markers
            createEntranceExit();
            
            // Path visualization
            createPath();
        }
        
        function createWalls() {
            const wallHeight = 3;
            const wallMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff });
            
            // Back wall
            const backWall = new THREE.BoxGeometry(storeLayout.width, wallHeight, 0.2);
            const backWallMesh = new THREE.Mesh(backWall, wallMaterial);
            backWallMesh.position.set(0, wallHeight/2, -storeLayout.height/2);
            scene.add(backWallMesh);
            
            // Left wall
            const leftWall = new THREE.BoxGeometry(0.2, wallHeight, storeLayout.height);
            const leftWallMesh = new THREE.Mesh(leftWall, wallMaterial);
            leftWallMesh.position.set(-storeLayout.width/2, wallHeight/2, 0);
            scene.add(leftWallMesh);
            
            // Right wall
            const rightWallMesh = new THREE.Mesh(leftWall, wallMaterial);
            rightWallMesh.position.set(storeLayout.width/2, wallHeight/2, 0);
            scene.add(rightWallMesh);
            
            
            // Front wall with entrance
            const frontWallLeft = new THREE.BoxGeometry(12, wallHeight, 0.2);
            const frontWallLeftMesh = new THREE.Mesh(frontWallLeft, wallMaterial);
            frontWallLeftMesh.position.set(0, wallHeight/2, storeLayout.height/2);
            scene.add(frontWallLeftMesh);

            
            const frontWallRight = new THREE.BoxGeometry(12, wallHeight, 0.2);
            const frontWallRightMesh = new THREE.Mesh(frontWallRight, wallMaterial);
            frontWallRightMesh.position.set(0, wallHeight/2, storeLayout.height/2);
            scene.add(frontWallRightMesh);

            // bottom wall
            const bottomWall = new THREE.BoxGeometry(storeLayout.width + 0.2, 1, storeLayout.height + 0.2);
            const color = new THREE.MeshLambertMaterial({ color: 0xffffff });
            const bottomWallMesh = new THREE.Mesh(bottomWall, color);
            bottomWallMesh.position.set(0, -0.5, 0);
            scene.add(bottomWallMesh);
            
        }

        function createShelves() {
            const textureLoader = new THREE.TextureLoader();
            
            storeLayout.shelves.forEach((shelf, index) => {
                // Shelf structure
                const shelfGeometry = new THREE.BoxGeometry(shelf.width, shelf.height, shelf.depth);
                const shelfMaterial = new THREE.MeshLambertMaterial({ 
                    color: 0xeaff08,
                    transparent: true,
                    opacity: 1.0
                });
                const shelfMesh = new THREE.Mesh(shelfGeometry, shelfMaterial);
                shelfMesh.position.set(shelf.x, shelf.height/2, shelf.z);
                shelfMesh.castShadow = true;
                shelfMesh.receiveShadow = true;
                scene.add(shelfMesh);

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á
                if (index < 10) {
                    const frontGeometry = new THREE.PlaneGeometry(shelf.width, shelf.height);
                    
                    // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤/‡∏´‡∏•‡∏±‡∏á
                    const frontTexture = textureLoader.load('{% static "images/layout/front.png" %}'); //images/front.png
                    const frontMaterial = new THREE.MeshBasicMaterial({ 
                        map: frontTexture,
                        transparent: true,
                        side: THREE.DoubleSide
                    });

                    // ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                    const frontMesh = new THREE.Mesh(frontGeometry, frontMaterial);
                    frontMesh.position.set(
                        shelf.x,
                        shelf.height/2,
                        shelf.z + shelf.depth/2 + 0.01 // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
                    );
                    scene.add(frontMesh);

                    // ‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á
                    const backMesh = new THREE.Mesh(frontGeometry, frontMaterial);
                    backMesh.position.set(
                        shelf.x,
                        shelf.height/2,
                        shelf.z - shelf.depth/2 - 0.01
                    );
                    backMesh.rotation.y = Math.PI;
                    scene.add(backMesh);

                    // ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÉ‡∏ä‡πâ‡∏™‡∏µ
                    const sideMaterial = new THREE.MeshLambertMaterial({ color: 0xeaff08 });
                    
                    // ‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢
                    const leftGeometry = new THREE.PlaneGeometry(shelf.depth, shelf.height);
                    const leftMesh = new THREE.Mesh(leftGeometry, sideMaterial);
                    leftMesh.position.set(
                        shelf.x - shelf.width/2 - 0.01,
                        shelf.height/2,
                        shelf.z
                    );
                    leftMesh.rotation.y = Math.PI/2;
                    scene.add(leftMesh);

                    // ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤
                    const rightMesh = new THREE.Mesh(leftGeometry, sideMaterial);
                    rightMesh.position.set(
                        shelf.x + shelf.width/2 + 0.01,
                        shelf.height/2,
                        shelf.z
                    );
                    rightMesh.rotation.y = -Math.PI/2;
                    scene.add(rightMesh);

                    // ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
                    const topGeometry = new THREE.PlaneGeometry(shelf.width, shelf.depth);
                    const topMesh = new THREE.Mesh(topGeometry, sideMaterial);
                    topMesh.position.set(
                        shelf.x,
                        shelf.height + 0.01,
                        shelf.z
                    );
                    topMesh.rotation.x = -Math.PI/2;
                    scene.add(topMesh);
                }

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ö‡∏ô shelf
                const shelfProducts = productsList.filter(p => p.shelfId === shelf.id);
                shelf.products = shelfProducts;
                shelfProducts.forEach((product, i) => {
                    const productGeometry = new THREE.BoxGeometry(0.2, 0.3, 0.2);
                    const productMaterial = new THREE.MeshLambertMaterial({ color: product.color });
                    const productMesh = new THREE.Mesh(productGeometry, productMaterial);
                    productMesh.position.set(shelf.x + (i * 0.5) - 0.5, shelf.height + 0.15, shelf.z);
                    productMesh.castShadow = true;
                    scene.add(productMesh);
                });
            });
        }

        function createCounter() {
            const counterGeometry = new THREE.BoxGeometry(1, 1, 4);
            const counterMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const counterMesh = new THREE.Mesh(counterGeometry, counterMaterial);
            counterMesh.position.set(9.5, 0.5, 2);
            counterMesh.castShadow = true;
            scene.add(counterMesh);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô
            const cashierGeometry = new THREE.BoxGeometry(0.95, 0.5, 1);
            const cashierMaterial = new THREE.MeshLambertMaterial({ color: 0xF5F5F5 });
            const cashierMesh = new THREE.Mesh(cashierGeometry, cashierMaterial);
            cashierMesh.position.set(9.5, 1, 0.8);
            cashierMesh.castShadow = true;
            scene.add(cashierMesh);

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ö‡∏ô
            const machineGeometry = new THREE.BoxGeometry(0.5, 1, 1);
            const machineMaterial = new THREE.MeshLambertMaterial({ color: 0xF5F5F5 });
            const machineMesh = new THREE.Mesh(machineGeometry, machineMaterial);
            machineMesh.position.set(9.35, 1.3, 0.8);
            machineMesh.castShadow = true;
            scene.add(machineMesh);
        };

        function createEntranceExit() {
            // IN marker
            const inGeometry = new THREE.BoxGeometry(1, 0.1, 1);
            const inMaterial = new THREE.MeshLambertMaterial({ color: 0x00ff00 });
            const inMarker = new THREE.Mesh(inGeometry, inMaterial);
            inMarker.position.set(-8, 0, 5.5);
            scene.add(inMarker);
            
            // OUT marker
            const outGeometry = new THREE.BoxGeometry(1, 0.1, 1);
            const outMaterial = new THREE.MeshLambertMaterial({ color: 0xff0000 });
            const outMarker = new THREE.Mesh(outGeometry, outMaterial);
            outMarker.position.set(8, 0, 5.5);
            scene.add(outMarker);
        }
        
        function createPath() {
            const pathMaterial = new THREE.LineBasicMaterial({ 
                color: 0xa1a1a1, 
                linewidth: 3 
            });
            const pathGeometry = new THREE.BufferGeometry().setFromPoints(
                movementPath.map(p => new THREE.Vector3(p.x, 0, p.z))
            );
            const pathLine = new THREE.Line(pathGeometry, pathMaterial);
            scene.add(pathLine);
        }

        function createAvatar() {
            // Simple humanoid avatar
            const avatarGroup = new THREE.Group();
            
            // Body
            const bodyGeometry = new THREE.CylinderGeometry(0.3, 0.4, 1.2, 8);
            const bodyMaterial = new THREE.MeshLambertMaterial({ color: 0x4169E1 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.6;
            avatarGroup.add(body);
            
            // Head
            const headGeometry = new THREE.SphereGeometry(0.25, 16, 16);
            const headMaterial = new THREE.MeshLambertMaterial({ color: 0xffdbac });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.45;
            avatarGroup.add(head);
            
            // Arms
            const armGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.8, 8);
            const armMaterial = new THREE.MeshLambertMaterial({ color: 0xffdbac });
            
            const leftArm = new THREE.Mesh(armGeometry, armMaterial);
            leftArm.position.set(-0.5, 0.6, 0);
            avatarGroup.add(leftArm);
            
            const rightArm = new THREE.Mesh(armGeometry, armMaterial);
            rightArm.position.set(0.5, 0.6, 0);
            avatarGroup.add(rightArm);
            
            // Legs
            const legGeometry = new THREE.CylinderGeometry(0.1, 0.15, 0.8, 8);
            const legMaterial = new THREE.MeshLambertMaterial({ color: 0x000080 });
            
            const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
            leftLeg.position.set(-0.2, -0.4, 0);
            avatarGroup.add(leftLeg);
            
            const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
            rightLeg.position.set(0.2, -0.4, 0);
            avatarGroup.add(rightLeg);
            

            // Position avatar at start
            avatarGroup.position.set(movementPath[0].x, 0, movementPath[0].z);
            avatarGroup.castShadow = true;
            
            avatar = avatarGroup;
            scene.add(avatar);
        }
       
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
        function createReceptionist() {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.4, 1.2, 8), new THREE.MeshLambertMaterial({ color: 0x8B4513 }));
            body.position.y = 0.6;
            group.add(body);
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.25, 16, 16), new THREE.MeshLambertMaterial({ color: 0xffdbac }));
            head.position.y = 1.45;
            group.add(head);
            group.position.set(-8, 0, -5); // ‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤
            scene.add(group);
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏° cashier ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏≤‡∏ó‡πå‡πÄ‡∏ï‡∏≠‡∏£‡πå
        function createCashier() {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.4, 1.2, 8), new THREE.MeshLambertMaterial({ color: 0x228B22 }));
            body.position.y = 0.6;
            group.add(body);
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.25, 16, 16), new THREE.MeshLambertMaterial({ color: 0xffdbac }));
            head.position.y = 1.45;
            group.add(head);
            group.position.set(10.3, 0, 2); // ‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
            scene.add(group);
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ñ‡∏∏‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô
        function addBagToAvatar() {
            if (avatar.bagMesh) return;
            // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô addBagToAvatar()
                const bagGeometry = new THREE.Group();

                // ‡∏ï‡∏±‡∏ß‡∏ñ‡∏∏‡∏á‡∏´‡∏•‡∏±‡∏Å
                const mainBag = new THREE.Mesh(
                    new THREE.BoxGeometry(0.3, 0.4, 0.2),
                    new THREE.MeshLambertMaterial({ color: 0x55ff33 })
                );
                bagGeometry.add(mainBag);

                bagGeometry.position.set(0.5, 0.4, 0.2);
                avatar.add(bagGeometry);
                avatar.bagMesh = bagGeometry;
            hasBag = true;
        }

        function setupControls() {
            document.getElementById('startBtn').onclick = startSimulation;
            document.getElementById('pauseBtn').onclick = pauseSimulation;
            document.getElementById('resetBtn').onclick = resetSimulation;
            document.getElementById('cameraBtn').onclick = changeCameraMode;

            document.getElementById('continue-btn').onclick = continueShopping;
            document.getElementById('goto-cashier-btn').onclick = gotoCashier;
            
            // Mouse controls for camera
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });
            
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (isDragging && cameraMode === 0) {
                    const deltaMove = {
                        x: e.clientX - previousMousePosition.x,
                        y: e.clientY - previousMousePosition.y
                    };
                    
                    const spherical = new THREE.Spherical();
                    spherical.setFromVector3(camera.position);
                    spherical.theta -= deltaMove.x * 0.01;
                    spherical.phi += deltaMove.y * 0.01;
                    spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                    
                    camera.position.setFromSpherical(spherical);
                    camera.lookAt(0, 0, 0);
                    
                    previousMousePosition = { x: e.clientX, y: e.clientY };
                }
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            // Zoom with mouse wheel
            renderer.domElement.addEventListener('wheel', (e) => {
                if (cameraMode === 0) {
                    const factor = e.deltaY > 0 ? 1.1 : 0.9;
                    camera.position.multiplyScalar(factor);
                }
            });

            // ‡πÄ‡∏û‡∏¥‡πà‡∏° Touch Events
            let touchStartX = 0;
            let touchStartY = 0;

            renderer.domElement.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;
                isDragging = true;
                previousMousePosition = { x: touch.clientX, y: touch.clientY };
            }, false);

            renderer.domElement.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (isDragging && cameraMode === 0) {
                    const touch = e.touches[0];
                    const deltaMove = {
                        x: touch.clientX - previousMousePosition.x,
                        y: touch.clientY - previousMousePosition.y
                    };
                    
                    const spherical = new THREE.Spherical();
                    spherical.setFromVector3(camera.position);
                    spherical.theta -= deltaMove.x * 0.01;
                    spherical.phi += deltaMove.y * 0.01;
                    spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                    
                    camera.position.setFromSpherical(spherical);
                    camera.lookAt(0, 0, 0);
                    
                    previousMousePosition = { x: touch.clientX, y: touch.clientY };
                }
            }, false);

            renderer.domElement.addEventListener('touchend', (e) => {
                e.preventDefault();
                isDragging = false;
            }, false);

            // Pinch to zoom
            let initialPinchDistance = null;
            
            renderer.domElement.addEventListener('touchstart', (e) => {
                if (e.touches.length === 2) {
                    initialPinchDistance = getPinchDistance(e);
                }
            }, false);

            renderer.domElement.addEventListener('touchmove', (e) => {
                if (e.touches.length === 2 && initialPinchDistance !== null) {
                    const currentDistance = getPinchDistance(e);
                    const scale = initialPinchDistance / currentDistance;
                    
                    if (cameraMode === 0) {
                        camera.position.multiplyScalar(scale);
                    }
                    
                    initialPinchDistance = currentDistance;
                }
            }, false);

            renderer.domElement.addEventListener('touchend', () => {
                initialPinchDistance = null;
            }, false);
        }

        function getPinchDistance(e) {
            return Math.hypot(
                e.touches[0].clientX - e.touches[1].clientX,
                e.touches[0].clientY - e.touches[1].clientY
            );
        }
        
        function startSimulation() {
            isRunning = true;
            isPaused = false;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
        }
        
        function pauseSimulation() {
            isPaused = !isPaused;
            const btn = document.getElementById('pauseBtn');
            btn.textContent = isPaused ? '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πà‡∏≠' : '‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß';
        }
        
        function resetSimulation() {
            isRunning = false;
            isPaused = false;
            isShoppping = false;
            currentPathIndex = 0;
            cart = [];
            hasBag = false;
            
            avatar.position.set(movementPath[0].x, 0, movementPath[0].z);
            
            if (avatar.bagMesh) {
                avatar.remove(avatar.bagMesh);
                avatar.bagMesh = null;
            }
            
            document.getElementById('shopping-menu').style.display = 'none';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('pauseBtn').textContent = '‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß';
        }
        
        function changeCameraMode() {
            cameraMode = (cameraMode + 1) % 3;
            const btn = document.getElementById('cameraBtn');
            
            switch(cameraMode) {
                case 0:
                    btn.textContent = '‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏£‡∏ß‡∏°';
                    camera.position.set(0, 15, 15);
                    camera.lookAt(0, 0, 0);
                    break;
                case 1:
                    btn.textContent = '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°';
                    break;
                case 2:
                    btn.textContent = '‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏ô';
                    break;
            }
        }
        
        function updateAvatar() {
            if (!isRunning || isPaused || isShoppping) return;

            const currentTarget = movementPath[currentPathIndex];
            const distance = new THREE.Vector3(currentTarget.x, 0, currentTarget.z).distanceTo(avatar.position);
            
            if (distance < 0.5) {
                const shelfId = currentTarget.shelfId;
                if (shelfId !== null) {
                    isShoppping = true;
                    if (shelfId === 'cashier') {
                        showCheckoutMenu();
                    } else {
                        const shelf = storeLayout.shelves.find(s => s.id === shelfId);
                        if (shelf) {
                            showShoppingMenu(shelf);
                        } else {
                            currentPathIndex++;
                        }
                    }
                } else {
                    currentPathIndex++;
                }
                return;
            }
            
            if (currentPathIndex >= movementPath.length - 1) {
                isRunning = false;
                document.getElementById('startBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = true;
                return;
            }

            const nextTarget = movementPath[currentPathIndex];
            const currentPos = avatar.position;
            
            const direction = new THREE.Vector3(
                nextTarget.x - currentPos.x,
                0,
                nextTarget.z - currentPos.z
            );
            
            direction.normalize();
            const speed = 0.02;
            avatar.position.add(direction.multiplyScalar(speed));
            
            avatar.lookAt(nextTarget.x, avatar.position.y, nextTarget.z);
            
            const time = Date.now() * 0.01;
            avatar.children[3].rotation.x = Math.sin(time) * 0.3;
            avatar.children[4].rotation.x = -Math.sin(time) * 0.3;
            avatar.children[1].rotation.x = Math.sin(time) * 0.1;
            avatar.children[2].rotation.x = -Math.sin(time) * 0.1;
        }

        function showCheckoutMenu() {
            isShoppping = true;
            const menu = document.getElementById('shopping-menu');
            const productList = document.getElementById('product-list');
            
            let total = 0;
            productList.innerHTML = '<h4>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>';
            
            cart.forEach(itemName => {
                const product = productsList.find(p => p.name === itemName);
                if (product) {
                    total += product.price;
                    productList.innerHTML += `
                        <div style="margin: 10px 0;">
                            <span>${product.name} - ${product.price} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `;
                }
            });
            
            productList.innerHTML += `
                <div style="margin-top: 20px; font-weight: bold;">
                    ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: ${total} ‡∏ö‡∏≤‡∏ó
                </div>
                <div style="margin-top: 10px;">
                    <button onclick="checkout()">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
                </div>
            `;
            
            menu.style.display = 'block';

            document.getElementById('continue-btn').style.display = 'none';
            document.getElementById('goto-cashier-btn').style.display = 'none';
        }

        function checkout() {

            addBagToAvatar();
            document.getElementById('shopping-menu').style.display = 'none';
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            hasBag = true;
            isShoppping = false;
            isRunning = true;
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            const stats = document.getElementById('stats');
            const successMsg = document.querySelector('.checkout-success');
            if (successMsg) {
                successMsg.remove();
            }
            stats.innerHTML += `
                <div class="checkout-success" style="color: #4CAF50;">
                    ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!
                </div>
            `;

            // ‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
            const exitPoint = movementPath[movementPath.length - 1];
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á avatar
            avatar.position.set(exitPoint.x, 0, exitPoint.z);
            avatar.lookAt(new THREE.Vector3(exitPoint.x, 0, exitPoint.z + 1));
            
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏à‡∏∏‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
            currentPathIndex = movementPath.length - 1;
        }
        
        function updateCamera() {
            if (cameraMode === 1) { // Follow mode
                const offset = new THREE.Vector3(0, 8, 8);
                camera.position.copy(avatar.position).add(offset);
                camera.lookAt(avatar.position);
            } else if (cameraMode === 2) { // First person mode
                const offset = new THREE.Vector3(0, 1.7, 0);
                camera.position.copy(avatar.position).add(offset);
                
                if (currentPathIndex < movementPath.length - 1) {
                    const target = movementPath[currentPathIndex + 1];
                    camera.lookAt(target.x, camera.position.y, target.z);
                }
            }
        }
        
        function updateStats() {
            const stats = document.getElementById('stats');
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°
            let total = 0;
            cart.forEach(itemName => {
                const product = productsList.find(p => p.name === itemName);
                if (product) {
                    total += product.price;
                }
            });
            
            stats.innerHTML = `
                <div>‡∏à‡∏∏‡∏î‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${currentPathIndex}/${movementPath.length - 1}</div>
                <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${isRunning ? (isPaused ? '‡∏´‡∏¢‡∏∏‡∏î‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß' : isShoppping ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏∑‡πâ‡∏≠' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏î‡∏¥‡∏ô') : '‡∏´‡∏¢‡∏∏‡∏î'}</div>
                <div>‡∏°‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á: ${['‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏£‡∏ß‡∏°', '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°', '‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏ô'][cameraMode]}</div>
                <div>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô: <a style="color: #FF6045;">${cart.join(', ')}</a></div>
                <div>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: <span style="color: #FFD700;">${total} ‡∏ö‡∏≤‡∏ó</span></div>
                <div style="color: #4CAF50;"> ${hasBag ? '‡∏ñ‡∏∑‡∏≠‡∏ñ‡∏∏‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß' : ''}</div>
            `;
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            updateAvatar();
            updateCamera();
            updateStats();
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        window.addEventListener('resize', onWindowResize);
        
        // Initialize the application
        init();

        function showShoppingMenu(shelf) {
            isShoppping = true;
            const menu = document.getElementById('shopping-menu');
            const productList = document.getElementById('product-list');
            
            productList.innerHTML = '<h4>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á‡∏ô‡∏µ‡πâ</h4>';
            shelf.products.forEach(product => {
                productList.innerHTML += `
                    <div style="margin: 10px 0;">
                        <span class="product-name">${product.name} - ${product.price} ‡∏ö‡∏≤‡∏ó</span>
                        <button class="add-to-cart-btn" onclick="addToCart('${product.name}')">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô</button>
                    </div>
                `;
            });
            
            menu.style.display = 'block';
            
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('resetBtn').disabled = true;
            document.getElementById('cameraBtn').disabled = true;

            document.getElementById('continue-btn').style.display = 'inline-block';
            document.getElementById('goto-cashier-btn').style.display = 'inline-block';
        }

        function addToCart(productName) {
            if (!cart.includes(productName)) {
                cart.push(productName);
                updateStats();
                alert(`${productName} ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß!`);
            } else {
                alert(`${productName} ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß!`);
            }
        }

        function continueShopping() {
            isShoppping = false;
            document.getElementById('shopping-menu').style.display = 'none';
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('cameraBtn').disabled = false;
            currentPathIndex++;
        }

        function gotoCashier() {
            // ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏≤‡∏ó‡πå‡πÄ‡∏ï‡∏≠‡∏£‡πå
            isShoppping = false;
            document.getElementById('shopping-menu').style.display = 'none';
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('resetBtn').disabled = false;
            document.getElementById('cameraBtn').disabled = false;

            const cashierIndex = movementPath.findIndex(p => p.shelfId === 'cashier');
            if (cashierIndex !== -1) {
                currentPathIndex = cashierIndex;
            }
        }
    </script>
</body>
</html>